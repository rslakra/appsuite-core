# Author: Rohtash Lakra
name: Build Maven Package

run-name: Deploy to ${{ inputs.deploy_target }} by @${{ github.actor }}

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]


permissions:
  contents: read


jobs:

  build:
    name: Build & Test - Units & Integrations
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      # makes sure that workflow has access to the code.
      - name: Set up JDK 21
      - uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      # Step for compiling code
      - name: Build Maven Package
        run: mvn -B clean package -DskipTests

      # Step for running unit-tests
      - name: Maven Verify
        run: mvn -B clean verify

#      - name: Maven Verify Integration Tests
#        run: mvn -B clean verify -Pintegration-test
#
#    - name: Run the Maven verify phase
#      run: mvn --batch-mode --update-snapshots verify
#    - run: mkdir releases && cp target/*.jar releases
#
#      - name: Upload build artifacts
#        uses: actions/upload-artifact@v4
#        with:
#          name: Package
#          path: releases


# Keeping the following code commented for the time being

#
#  sonar:
#    name: Build - SonarCloud Scan
#    runs-on: ubuntu-18.04
#
#    steps:
#      - uses: actions/checkout@v4
#      - name: Set up JDK 21
#        uses: actions/setup-java@v4
#        with:
#          java-version: 21
#      - name: SonarCloud Scan
#        run: mvn -B clean verify -Psonar -Dsonar.login=${{ secrets.SONAR_TOKEN }}
#        env:
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#
#  artifact:
#    name: Publish - GitHub Packages
#    runs-on: ubuntu-18.04
#    needs: [build, sonar]
#
#    steps:
#      - uses: actions/checkout@v4
#      - name: Set up JDK 21
#        uses: actions/setup-java@v4
#        with:
#          java-version: 21
#      - name: Publish artifact on GitHub Packages
#        run: mvn -B clean deploy -DskipTests
#        env:
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#
#
#  docker:
#    name: Publish - Build to Docker Hub
#    runs-on: ubuntu-18.04
#    needs: [build, sonar]
#    env:
#      REPO: ${{ secrets.DOCKER_REPO }}
#
#    steps:
#      - uses: actions/checkout@v4
#      - name: Set up JDK 21
#        uses: actions/setup-java@v4
#        with:
#          java-version: 21
#      - name: Login to Docker Hub
#        run: docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_PASS }}
#      - name: Build Docker image
#        run: docker build -t $REPO:latest -t $REPO:${GITHUB_SHA::8} .
#      - name: Publish Docker image
#        run: docker push $REPO

